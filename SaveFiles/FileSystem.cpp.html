<!Doctype html>
<meta hettp-equiv="x-ua-compatible" content="IE=11">
<html>
  <head>
    <style>
      body {
        padding:15px 40px;
        font-family: Consolas;
        font-size: 1.25em;
        font-weight: normal;
      }
      span {
        display:inline;
      }
    </style>
    <script>
      function showHideClass(className) {
        let elems = document.getElementsByClassName(className);
        if (elems === null) {
          return;
        }
        for (let i = 0; i < elems.length; ++i) {
          let displayProp = elems[i].style.display;
          if (displayProp === 'none')
            elems[i].style['display'] = "inline";
          else
            elems[i].style['display'] = "none";
        }
      }
    </script>
  </head>
  <body>
    <button name="button1" onclick="showHideClass('toggleClassDisplay')">Show or Hide Class Contents</button>
    <button name="button2" onclick="showHideClass('toggleMethodDisplay')">Show or Hide Method Contents</button>
    <button name="button3" onclick="showHideClass('toggleCommentDisplay')">Show or Hide Conment Contents</button><h3>FileSystem.cpp</h3><pre><div class="toggleCommentDisplay">/////////////////////////////////////////////////////////////////////////////</div>
<div class="toggleCommentDisplay">// FileSystem.cpp - Support file and directory operations                  //</div>
<div class="toggleCommentDisplay">// ver 2.8                                                                 //</div>
<div class="toggleCommentDisplay">// ----------------------------------------------------------------------- //</div>
<div class="toggleCommentDisplay">// copyright © Jim Fawcett, 2012                                           //</div>
<div class="toggleCommentDisplay">// All rights granted provided that this notice is retained                //</div>
<div class="toggleCommentDisplay">// ----------------------------------------------------------------------- //</div>
<div class="toggleCommentDisplay">// Language:    Visual C++, Visual Studio 2010                             //</div>
<div class="toggleCommentDisplay">// Platform:    Dell XPS 8300, Core i7, Windows 7 SP1                      //</div>
<div class="toggleCommentDisplay">// Application: Summer Projects, 2012                                      //</div>
<div class="toggleCommentDisplay">// Author:      Jim Fawcett, CST 4-187, Syracuse University                //</div>
<div class="toggleCommentDisplay">//              (315) 443-3948, jfawcett@twcny.rr.com                      //</div>
<div class="toggleCommentDisplay">/////////////////////////////////////////////////////////////////////////////</div>

#include &ltiostream&gt
#include &ltstring&gt
#include &ltsstream&gt
#include &ltiomanip&gt
#include &ltutility&gt
#include &ltclocale&gt
#include &ltlocale&gt
#include "<a href="FileSystem.h.html">FileSystem.h"</a>

using namespace FileSystem;

<div class="toggleCommentDisplay">/////////////////////////////////////////////////////////</div>
<div class="toggleCommentDisplay">// helper FileSystemSearch</div>

class FileSystemSearch
{
<div class="toggleClassDisplay">
public:
  FileSystemSearch();
  ~FileSystemSearch();
  std::string firstFile(const std::string& path=".", const std::string& pattern="*.*");
  std::string nextFile();
  std::string firstDirectory(const std::string& path=".", const std::string& pattern="*.*");
  std::string nextDirectory();
  void close();
private:
  HANDLE hFindFile;
  WIN32_FIND_DATAA FindFileData;
  WIN32_FIND_DATAA* pFindFileData;
};

</div>
FileSystemSearch::FileSystemSearch() : pFindFileData(&FindFileData) {}
<div class="toggleMethodDisplay">
</div>
FileSystemSearch::~FileSystemSearch() { ::FindClose(hFindFile); }
<div class="toggleMethodDisplay">
</div>
void FileSystemSearch::close() { ::FindClose(hFindFile); }
<div class="toggleMethodDisplay">
</div>

<div class="toggleCommentDisplay">//----&lt block constructor taking array iterators &gt-------------------------</div>

Block::Blocst_of("\\");
    if(pos &gt= fileSpec.length())
    {
      <div class="toggleCommentDisplay">// no path prepended</div>
      if(withExt)
        return fileSpec;
      else
      {
        <div class="toggleCommentDisplay">// remove ext</div>
        size_t pos = fileSpec.find(".");
        if(pos &gt fileSpec.size())
          return fileSpec;
        return fileSpec.substr(0, pos-1);
      }
    }
  }
  if(withExt)
    return fileSpec.substr(pos+1,fileSpec.length()-pos);
  else
  {
    <div class="toggleCommentDisplay">// remove ext</div>
    size_t pos2 = fileSpec.find(".", pos);
    if(pos2 &gt fileSpec.size())
      <div class="toggleCommentDisplay">// no ext</div>
      return fileSpec.substr(pos+1);
    return fileSpec.substr(pos+1, pos2-pos-1);
  }
}
</div>
<div class="toggleCommentDisplay">//----&lt get extension from fileSpec &gt----------------------------------</div>
  
std::string Path::getExt(const std::string& fileSpec)
{
<div class="toggleMethodDisplay">
  quality comparison &gt----------------------------------------------</div>

bool Block::operator==(const Block& block) const
{
<div class="toggleMethodDisplay">
  return bytes_ == block.bytes_;
}
</div>
<div class="toggleCommentDisplay">//----&lt inequality comparison &gt--------------------------------------------</div>

bool Block::operator!=(const Block& block) const
{
  return bytes_ != block.bytes_;
}
<div class="toggleCommentDisplay">//----&lt return number of bytes in block &gt----------------------------------</div>

size_t Block::size() const
{
<div class="toggleMethodDisplay">
  return bytes_.size();
}
</div>

<div class="toggleCommentDisplay">//----&lt File constructor opens file stream &gt-------------------------------</div>

File::File(const std::string& filespec) 
    : name_(filespec), pIStream(nullptr), pOStream(nullptr), dirn_(in), typ_(text), good_(true)
{
<div class="toggleMethodDisplay">
}
</div>
<div class="toggleCommentDisplay">//----&lt File destructor cl<!Doctype html>
<meta hettp-equiv="x-ua-compatible" content="IE=11">
<html>
  <head>
    <style>
      body {
        padding:15px 40px;
        font-family: Consolas;
        font-size: 1.25em;
        font-weight: normal;
      }
      span {
        display:inline;
      }
    </style>
    <script>
      function showHideClass(className) {
        let elems = document.getElementsByClassName(className);
        if (elems === null) {
          return;
        }
        for (let i = 0; i < elems.length; ++i) {
          let displayProp = elems[i].style.display;
          if (displayProp === 'none')
            elems[i].style['display'] = "inline";
          else
            elems[i].style['display'] = "none";
        }
      }
    </script>
  </head>
  <body>
    <button name="button1" onclick="showHideClass('toggleClassDisplay')">Show or Hide Class Contents</button>
    <button name="button2" onclick="showHideClass('toggleMethodDisplay')">Show or Hide Method Contents</button>e constructor");</div>
    }
  }
  else
  {
    pOStream = new std::ofstream;
    if(typ == binary)
      pOStream-&gtopen(name_.c_str(), std::ios::out | std::ios::binary);
    else
      pOStream-&gtopen(name_.c_str(), std::ios::out);
    if (!(*pOStream).good())
    {
      good_ = false;
      pOStream = nullptr;
      <div class="toggleCommentDisplay">//throw std::runtime_error("\n  open for output failed in File constructor");</div>
    }
  }
  return good_;
}
</div>
<div class="toggleCommentDisplay">//----&lt reads one line of a text file &gt------------------------------------</div>

std::string File::getLine(bool keepNewLines)
{
<div class="toggleMethodDisplay">
  if(pIStream == nullptr || !pIStream-&gtgood())
    throw std::runtime_error("input stream not open");
  if(typ_ == binary)
    throw std::runtime_error("getting text line from binary file");
  if(dirn_ == out)
    throw std::runtime_error("reading output file");

  std::string store;
  while (true)
  {
    char ch = pIStream-&gtget();
    if (!isGood())
      return store;
    if (ch == '\n')
    {
      if (keepNewLines)
        store += ch;
      return store;
    }
    store += ch;
  }
}
</div>
<div class="toggleCommentDisplay">//----&lt read all lines of text file into one string &gt----------------------</div>

std::string File::readAll(bool keepNewLines)
{
<div class="toggleMethodDisplay">
  std::string store;
  while (true)
  {
    if (!isGood())
      return store;
    store += getLine(keepNewLines);
    std::locale loc;
    if (store.size() &gt 0 && !std::isspace(store[store.size() - 1], loc))
      store += ' ';
  }
  return store;
}
</div>
<div class="toggleCommentDisplay">//----&lt writes one line of a text to a file &gt------------------------------</div>

void File::putLine(const std::string& s, bool wantReturn)
{
<div class="toggleMethodDisplay">
  if(pOStream == nullptr || !pOStream-&gtgood())
    throw std::runtime_error("output stream not open");
  if(typ_ == binary)
    throw std::runtime_error("writing text line to binary file");
  if(dirn_ == in)
    throw std::runtime_error("writing input file");
  for(size_t i=0; i&lts.size(); ++i)
    pOStream-&gtput(s[i]);
  if(wantReturn)
    pOStream-&gtput('\n');
  pOStream-&gtflush();
}
</div>
<div class="toggleCommentDisplay">//----&lt reads a block of bytes from binary file &gt--------------------------</div>

Block File::getBlock(size_t size)
{
<div class="toggleMethodDisplay">
  if(pIStream == nullptr || !pIStream-&gtgood())
    throw std::runtime_error("input stream not open");
  if(typ_ != binary)
    throw std::runtime_error("reading binary from text file");
  if(dirn_ == out)
    throw std::runtime_error("reading output file");
  Block blk;
  if(pIStream)
  {
    for(size_t i=0; i&ltsize; ++i)
    {
      Byte b;
      pIStream-&gtget(b);
      if(pIStream-&gtgood())
        blk.push_back(b);
      else
        break;
    }
  }
  return blk;
}
</div>
<div class="toggleCo
    <button name="button3" onclick="showHideClass('toggleCommentDisplay')">Show or Hide Conment Contents</button><h3>FileSystem.cpp</h3><pre><div class="toggleCommentDisplay">/////////////////////////////////////////////////////////////////////////////</div>
<div class="toggleCommentDisplay">// FileSystem.cpp - Support file and directory operations                  //</div>
<div class="toggleCommentDisplay">// ver 2.8                                                                 //</div>
<div class="toggleCommentDisplay">// ----------------------------------------------------------------------- //</div>
<div class="toggleCommentDisplay">// copyright © Jim Fawcett, 2012                                           //</div>
<div class="toggleCommentDisplay">// All rights granted provided that this notice is retained                //</div>
<div class="toggleCommentDisplay">// ----------------------------------------------------------------------- //</div>
<div class="toggleCommentDisplay">// Language:  runtime_error("reading output file");
  size_t count = 0;
  while (pIStream-&gtgood())
  {
    buffer[count++] = pIStream-&gtget();
      if (count == bufLen)
        break;
  }
  if (!pIStream-&gtgood())  <div class="toggleCommentDisplay">// don't write EOF char</div>
    --count;
  return count;
}
</div>
<div class="toggleCommentDisplay">//----&lt write buffer of bytes to binary file &gt-------------------------------</div>

void File::putBuffer(size_t bufLen, File::byte* buffer)
{
<div class="toggleMethodDisplay">
  if (pOStream == nullptr || !pOStream-&gtgood())
    throw std::runtime_error("output stream not open");
  if (typ_ != binary)
    throw std::runtime_error("writing binary to text file");
  if (dirn_ == in)
    throw std::runtime_error("writing input file");
  if (!pOStream-&gtgood())
    return;
  size_t count = 0;
  while(pOStream-&gtgood())
  {
    pOStream-&gtput(buffer[count++]);
    if (count == bufLen)
      break;
  }
}
</div>
<div class="toggleCommentDisplay">//----&lt tests for error free stream state &gt--------------------------------</div>

bool File::isGood()
{
<div class="toggleMethodDisplay">
  if(!good_)
    return false;
  if(pIStream != nullptr)
    return (good_ = pIStream-&gtgood());
  if(pOStream != nullptr)
    return (good_ = pOStream-&gtgood());
  return (good_ = false);
}
</div>
<div class="toggleCommentDisplay">//----&lt flushes output stream to its file &gt--------------------------------</div>

void File::flush()
{
<div class="toggleMethodDisplay">
  if(pOStream != nullptr && pOStream-&gtgood())
    pOStream-&gtflush();
}
</div>
<div class="toggleCommentDisplay">//----&lt clears error state enabling operations again &gt---------------------</div>

void File::clear()
{
<div class="toggleMethodDisplay">
  if(pIStream != nullptr)
    pIStream-&gtclear();
  if(pOStream != nullptr)
    pOStream-&gtclear();
}
</div>
<div class="toggleCommentDisplay">//----&lt close file handle &gt------------------------------------------------</div>

void File::close()
{
<div class="toggleMethodDisplay">
  File::flush();
  if (pIStream != nullptr)
  {
    pIStream-&gtclose();
    pIStream = nullptr;
    good_ = false;
  }
  if (pOStream)
  {
    pOStream-&gtclose();
    pOStream = nullptr;
    good_ = false;
  }
}
</div>
<div class="toggleCommentDisplay">//----&lt file exists &gt--------------------------------------------------</div>

bool File::exists(const std::string& file)
{
<div class="toggleMethodDisplay">
  return ::GetFileAttributesA(file.c_str()) != INVALID_FILE_ATTRIBUTES;
}
</div>
<div class="toggleCommentDisplay">//----&lt copy file &gt----------------------------------------------------</div>

bool File::copy(const std::string& src, const std::string& dst, bool failIfExists)
{
<div class="toggleMethodDisplay">
  return ::CopyFileA(src.c_str(), dst.c_str(), failIfExists) != 0;
}
</div>
<div class="toggleCommentDisplay">//----&lt remove file &gt-------------------------------------  Visual C++, Visual Studio 2010                             //</div>
<div class="toggleCommentDisplay">// Platform:    Dell XPS 8300, Core i7, Windows 7 SP1                      //</div>
<div class="toggleCommentDisplay">// Application: Summer Projects, 2012                                      //</div>
<div class="toggleCommentDisplay">// Author:      Jim Fawcett, CST 4-187, Syracuse University                //</div>
<div class="toggleCommentDisplay">//              (315) 443-3948, jfawcett@twcny.rr.com                      //</div>
<div class="toggleCommentDisplay">/////////////////////////////////////////////////////////////////////////////</div>

#include &ltiostream&gt
#include &ltstring&gt
#include &ltsstream&gt
#include &ltiomanip&gt
#include &ltutility&gt
#include &ltclocale&gt
#include &ltlocale&gt
#include "<a href="FileSystem.h.html">FileSystem.h"</a>

using namespace FileSystem;

<div class="toggleCommentDisplay">/////////////////////////////////////////////////////////</div>
----------------------------------</div>

std::string FileInfo::name() const
{
<div class="toggleMethodDisplay">
  return Path::getName(data.cFileName);
}
</div>
<div class="toggleCommentDisplay">//----&lt conversion helper &gt--------------------------------------------</div>

std::string FileInfo::intToString(long i)
{
<div class="toggleMethodDisplay">
  std::ostringstream out;
  out.fill('0');
  out &lt&lt std::setw(2) &lt&lt i;
  return out.str();
}
</div>
<div class="toggleCommentDisplay">//----&lt return file date &gt---------------------------------------------</div>

std::string FileInfo::date(dateFormat df) const
{
<div class="toggleMethodDisplay">
  std::string dateStr, timeStr;
  FILETIME ft;
  SYSTEMTIME st;
  ::FileTimeToLocalFileTime(&data.ftLastWriteTime, &ft);
  ::FileTimeToSystemTime(&ft, &st);
  dateStr = intToString(st.wMonth) + '/' + intToString(st.wDay) + '/' + intToString(st.wYear);
  timeStr = intToString(st.wHour) + ':' + intToString(st.wMinute) + ':' + intToString(st.wSecond);
  if(df == dateformat)
    return dateStr;
  if(df == timeformat)
    return timeStr;
  return dateStr + " " + timeStr;
}
</div>
<div class="toggleCommentDisplay">//----&lt return file size &gt---------------------------------------------</div>

size_t FileInfo::size() const
{
<div class="toggleMethodDisplay">
  return (size_t)(data.nFileSizeLow + (data.nFileSizeHigh &lt&lt 8));
}
</div>
<div class="toggleCommentDisplay">//----&lt is type archive? &gt---------------------------------------------</div>

bool FileInfo::isArchive() const
{
<div class="toggleMethodDisplay">
  return (data.dwFileAttributes & FILE_ATTRIBUTE_ARCHIVE) != 0;
}
</div>
<div class="toggleCommentDisplay">//----&lt is type compressed? &gt------------------------------------------</div>

bool FileInfo::isCompressed() const
{
<div class="toggleMethodDisplay">
  return (data.dwFileAttributes & FILE_ATTRIBUTE_COMPRESSED) != 0;
}
</div>
<div class="toggleCommentDisplay">//----&lt is type directory? &gt-------------------------------------------</div>

bool FileInfo::isDirectory() const
{
<div class="toggleMethodDisplay">
  return (data.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY) != 0;
}
</div>
<div class="toggleCommentDisplay">//----&lt is type encrypted? &gt---------------------------------------------</div>

bool FileInfo::isEncrypted() const
{
<div class="toggleMethodDisplay">
  return (data.dwFileAttributes & FILE_ATTRIBUTE_ENCRYPTED) != 0;
}
</div>
<div class="toggleCommentDisplay">//----&lt is type hiddent? &gt---------------------------------------------</div>

bool FileInfo::isHidden() const
{
<div class="toggleMethodDisplay">
  return (data.dwFileAttributes & FILE_ATTRIBUTE_HIDDEN) != 0;
}
</div>
<div class="toggleCommentDisplay">//----&lt is type normal? &gt---------------------------------------------</div>

bool FileInfo::isNormal() const
{
<div class="toggleMethodDisplay">
  return (data.dwFileAttributes & FILE_ATTRIBUTE_NORMAL) != 0;
}
</div>
<div <div class="toggleCommentDisplay">// helper FileSystemSearch</div>

class FileSystemSearch
{
<div class="toggleClassDisplay">
public:
  FileSystemSearch();
  ~FileSystemSearch();
  std::string firstFile(const std::string& path=".", const std::string& pattern="*.*");
  std::string nextFile();
  std::string firstDirectory(const std::string& path=".", const std::string& pattern="*.*");
  std::string nextDirectory();
  void close();
private:
  HANDLE hFindFile;
  WIN32_FIND_DATAA FindFileData;
  WIN32_FIND_DATAA* pFindFileData;
};

</div>
FileSystemSearch::FileSystemSearch() : pFindFileData(&FindFileData) {}
<div class="toggleMethodDisplay">
</div>
FileSystemSearch::~FileSystemSearch() { ::FindClose(hFindFile); }
<div class="toggleMethodDisplay">
</div>
void FileSystemSearch::close() { ::FindClose(hFindFile); }
<div class="toggleMethodDisplay">
</div>

<div class="toggleCommentDisplay">//----&lt block constructor taking array iterators &gt-------------------------</div>

Block::Blo FILE_ATTRIBUTE_TEMPORARY) != 0;
}
</div>
<div class="toggleCommentDisplay">//----&lt compare names alphabetically &gt---------------------------------</div>

bool FileInfo::operator&lt(const FileInfo& fi) const
{
<div class="toggleMethodDisplay">
  return strcmp(data.cFileName, fi.data.cFileName) == -1;
}
</div>
<div class="toggleCommentDisplay">//----&lt compare names alphabetically &gt---------------------------------</div>

bool FileInfo::operator==(const FileInfo& fi) const
{
<div class="toggleMethodDisplay">
  return strcmp(data.cFileName, fi.data.cFileName) == 0;
}
</div>
<div class="toggleCommentDisplay">//----&lt compare names alphabetically &gt---------------------------------</div>

bool FileInfo::operator&gt(const FileInfo& fi) const
{
<div class="toggleMethodDisplay">
  return strcmp(data.cFileName, fi.data.cFileName) == 1;
}
</div>
<div class="toggleCommentDisplay">//----&lt compare file times &gt-------------------------------------------</div>

bool FileInfo::earlier(const FileInfo& fi) const
{
<div class="toggleMethodDisplay">
  FILETIME ft1 = data.ftLastWriteTime;
  FILETIME ft2 = fi.data.ftLastWriteTime;
  return ::CompareFileTime(&ft1, &ft2) == -1;
}
</div>
<div class="toggleCommentDisplay">//----&lt compare file times &gt-------------------------------------------</div>

bool FileInfo::later(const FileInfo& fi) const
{
<div class="toggleMethodDisplay">
  FILETIME ft1 = data.ftLastWriteTime;
  FILETIME ft2 = fi.data.ftLastWriteTime;
  return ::CompareFileTime(&ft1, &ft2) == 1;
}
</div>
<div class="toggleCommentDisplay">//----&lt smaller &gt------------------------------------------------------</div>

bool FileInfo::smaller(const FileInfo &fi) const
{
<div class="toggleMethodDisplay">
  return size() &lt fi.size();
}
</div>
<div class="toggleCommentDisplay">//----&lt larger &gt-------------------------------------------------------</div>

bool FileInfo::larger(const FileInfo &fi) const
{
<div class="toggleMethodDisplay">
  return size(ck(Byte* beg, Byte* end) : bytes_(beg, end) {}
<div class="toggleMethodDisplay">
</div>

<div class="toggleCommentDisplay">//----&lt push back block byte &gt---------------------------------------------</div>

void Block::push_back(Byte b)
{
<div class="toggleMethodDisplay">
  bytes_.push_back(b);
}
</div>
<div class="toggleCommentDisplay">//----&lt non-const indexer &gt------------------------------------------------</div>

Byte& Block::operator[](size_t i)
{
<div class="toggleMethodDisplay">
  if(i&lt0 || bytes_.size() &lt= i)
    throw std::runtime_error("index out of range in Block");
  return bytes_[i];
}
</div>
<div class="toggleCommentDisplay">//----&lt const indexer &gt----------------------------------------------------</div>

Byte Block::operator[](size_t i) const
{
<div class="toggleMethodDisplay">
  if(i&lt0 || bytes_.size() &lt= i)
    throw std::runtime_error("index out of range in Block");
  return bytes_[i];
}
</div>
<div class="toggleCommentDisplay">//----&lt east_of("\\");
    if(pos &gt= fileSpec.length())
    {
      <div class="toggleCommentDisplay">// no path prepended</div>
      if(withExt)
        return fileSpec;
      else
      {
        <div class="toggleCommentDisplay">// remove ext</div>
        size_t pos = fileSpec.find(".");
        if(pos &gt fileSpec.size())
          return fileSpec;
        return fileSpec.substr(0, pos-1);
      }
    }
  }
  if(withExt)
    return fileSpec.substr(pos+1,fileSpec.length()-pos);
  else
  {
    <div class="toggleCommentDisplay">// remove ext</div>
    size_t pos2 = fileSpec.find(".", pos);
    if(pos2 &gt fileSpec.size())
      <div class="toggleCommentDisplay">// no ext</div>
      return fileSpec.substr(pos+1);
    return fileSpec.substr(pos+1, pos2-pos-1);
  }
}
</div>
<div class="toggleCommentDisplay">//----&lt get extension from fileSpec &gt----------------------------------</div>
  
std::string Path::getExt(const std::string& fileSpec)
{
<div class="toggleMethodDisplay">
  size_t pos1 = fileSpec.find_last_of('/');
  size_t pos2 = fileSpec.find_last_of('\\');
  size_t pos = fileSpec.find_last_of('.');
  <div class="toggleCommentDisplay">// handle ../ or ..\\ with no extension</div>
  if(pos1 &lt fileSpec.length() || pos2 &lt fileSpec.length())
  {
    if(pos &lt min(pos1, pos2))
      return std::string("");
  }
  <div class="toggleCommentDisplay">// only . is extension delimiter</div>
  if(0 &lt= pos && pos &lt fileSpec.length())
    return toLower(fileSpec.substr(pos+1,fileSpec.length()-pos));
  return std::string("");
}
</div>
<div class="toggleCommentDisplay">//----&lt get path from fileSpec &gt---------------------------------------</div>

std::string Path::getPath(const std::string &fileSpec)
{
<div class="toggleMethodDisplay">
  size_t pos = fileSpec.find_last_of("/");
  if(pos &gt= fileSpec.length())
    pos = fileSpec.find_last_of("\\");
  if(pos &gt= fileSpec.length())
    return ".";
  if(fileSpec.find(".",pos+1))
    return fileSpec.substr(0,pos+1);
  return fileSpec;
}
</div>
<div class="toggleCommentDisplay">//----&lt get absoluth path from fileSpec &gt------------------------------</div>

std::string Path::getFullFileSpec(const std::string &fileSpec)
{
<div class="toggleMethodDisplay">
  const size_t BufSize = 256;
  char buffer[BufSize];
  char filebuffer[BufSize];  <div class="toggleCommentDisplay">// don't use but GetFullPathName will</div>
  char* name = filebuffer;
  ::GetFullPathNameA(fileSpec.c_str(),BufSize, buffer, &name);
  return std::string(buffer);
}
</div>
<div class="toggleCommentDisplay">//----&lt create file spec from path and name &gt--------------------------</div>

std::string Path::fileSpec(const std::string &path, const std::string &name)
{
<div class="toggleMethodDisplay">
  std::string fs;
  size_t len = path.size();
  if(path[len-1] == '/' || path[len-1] == '\\')
    fs = path + name;
  else
  {
    if(path.find("/") &lt path.size())
      fs = path + "/" + name;
    else if(path.find("\\quality comparison &gt----------------------------------------------</div>

bool Block::operator==(const Block& block) const
{
<div class="toggleMethodDisplay">
  return bytes_ == block.bytes_;
}
</div>
<div class="toggleCommentDisplay">//----&lt inequality comparison &gt--------------------------------------------</div>

bool Block::operator!=(const Block& block) const
{
  return bytes_ != block.bytes_;
}
<div class="toggleCommentDisplay">//----&lt return number of bytes in block &gt----------------------------------</div>

size_t Block::size() const
{
<div class="toggleMethodDisplay">
  return bytes_.size();
}
</div>

<div class="toggleCommentDisplay">//----&lt File constructor opens file stream &gt-------------------------------</div>

File::File(const std::string& filespec) 
    : name_(filespec), pIStream(nullptr), pOStream(nullptr), dirn_(in), typ_(text), good_(true)
{
<div class="toggleMethodDisplay">
}
</div>
<div class="toggleCommentDisplay">//----&lt File destructor cl files;
  FileSystemSearch fss;
  std::string file = fss.firstFile(path, pattern);
  if(file.size() == 0)
    return files;
  files.push_back(file);
  while(true)
  {
    file = fss.nextFile();
    if(file.size() == 0)
      return files;
    files.push_back(file);
  }
  return files;
}
</div>
<div class="toggleCommentDisplay">//----&lt get names of all directories matching pattern (path:name) &gt--------</div>

std::vector&ltstd::string&gt Directory::getDirectories(const std::string& path, const std::string& pattern)
{
<div class="toggleMethodDisplay">
  std::vector&ltstd::string&gt dirs;
  FileSystemSearch fss;
  std::string dir = fss.firstDirectory(path, pattern);
  if(dir.size() == 0)
    return dirs;
  dirs.push_back(dir);
  while(true)
  {
    dir = fss.nextDirectory();
    if(dir.size() == 0)
      return dirs;
    dirs.push_back(dir);
  }
  return dirs;
}
</div>
<div class="toggleCommentDisplay">//----&lt create directory &gt-------------------------------------------------</div>

bool Directory::create(const std::string& path)
{
<div class="toggleMethodDisplay">
  return ::CreateDirectoryA(path.c_str(), NULL) == 0;
}
</div>
<div class="toggleCommentDisplay">//----&lt does directory exist? &gt--------------------------------------------</div>

bool Directory::exists(const std::string& path)
{
<div class="toggleMethodDisplay">
  DWORD dwAttrib = GetFileAttributesA(path.c_str());

  return (dwAttrib != INVALID_FILE_ATTRIBUTES && 
         (dwAttrib & FILE_ATTRIBUTE_DIRECTORY));
}
</div>
<div class="toggleCommentDisplay">//----&lt remove directory &gt-------------------------------------------------</div>

bool Directory::remove(const std::string& path)
{
<div class="toggleMethodDisplay">
  return ::RemoveDirectoryA(path.c_str()) == 0;
}
</div>
<div class="toggleCommentDisplay">//----&lt find first file &gt--------------------------------------------------</div>

std::string FileSystemSearch::firstFile(const std::string& path, const std::string& pattern)
{
<div class="toggleMethodDisplay">
  hFindFile = ::FindFirstFileA(Path::fileSpec(path, pattern).c_str(), pFindFileData);
  if(hFindFile != INVALID_HANDLE_VALUE)
  {
    if(!(pFindFileData-&gtdwFileAttributes & FILE_ATTRIBUTE_DIRECTORY))
      return pFindFileData-&gtcFileName;
    else
      while(::FindNextFileA(hFindFile, pFindFileData))
        if(!(pFindFileData-&gtdwFileAttributes & FILE_ATTRIBUTE_DIRECTORY))
          return pFindFileData-&gtcFileName;
  }
  return "";
}
</div>
<div class="toggleCommentDisplay">//----&lt find next file &gt---------------------------------------------------</div>

std::string FileSystemSearch::nextFile()
{
<div class="toggleMethodDisplay">
  while(::FindNextFileA(hFindFile, pFindFileData))
    if(!(pFindFileData-&gtdwFileAttributes & FILE_ATTRIBUTE_DIRECTORY))
      return pFindFileData-&gtcFileName;
  return "";
}
</div>
<div class="toggleCommentDisplay">//----&lt find first file &gt------------------------------------------------<!Doctype html>
<meta hettp-equiv="x-ua-compatible" content="IE=11">
<html>
  <head>
    <style>
      body {
        padding:15px 40px;
        font-family: Consolas;
        font-size: 1.25em;
        font-weight: normal;
      }
      span {
        display:inline;
      }
    </style>
    <script>
      function showHideClass(className) {
        let elems = document.getElementsByClassName(className);
        if (elems === null) {
          return;
        }
        for (let i = 0; i < elems.length; ++i) {
          let displayProp = elems[i].style.display;
          if (displayProp === 'none')
            elems[i].style['display'] = "inline";
          else
            elems[i].style['display'] = "none";
        }
      }
    </script>
  </head>
  <body>
    <button name="button1" onclick="showHideClass('toggleClassDisplay')">Show or Hide Class Contents</button>
    <button name="button2" onclick="showHideClass('toggleMethodDisplay')">Show or Hide Method Contents</button>eCommentDisplay">//----&lt test stub &gt--------------------------------------------------------</div>

#ifdef TEST_FILESYSTEM

void title(const std::string& title, char ch='=')
{
<div class="toggleMethodDisplay">
  std::cout &lt&lt "\n  " &lt&lt title;
  std::cout &lt&lt "\n " &lt&lt std::string(title.size()+2, ch);
}
</div>
int main(int argc, char* argv[])
{
<div class="toggleMethodDisplay">
  title("Demonstrate Path Class");

  std::string fs = Path::fileSpec(".","temp.txt");
  std::cout &lt&lt "\n  Path::fileSpec(\".\",\"temp.txt\") = " &lt&lt fs;

  std::string path = Path::getPath(fs);
  std::cout &lt&lt "\n  Path::getPath(\"" + fs + "\") = " &lt&lt path;
  
  std::string ffs = Path::getFullFileSpec(fs);
  std::cout &lt&lt "\n  Path::getFullFileSpec(\"" + fs + "\") = " &lt&lt ffs;
  
  std::string name = Path::getName(fs);
  std::cout &lt&lt "\n  Path::getName(\"" + fs + "\") = " &lt&lt name;

  std::string ext = Path::getExt(fs);
  std::cout &lt&lt "\n  Path::getExt(\"" + fs + "\") = " &lt&lt ext;

  std::string upper = Path::toUpper("temp.txt");
  std::cout &lt&lt "\n  Path::toUpper(\"temp.txt\") = " &lt&lt upper;

  std::string lower = Path::toLower("Temp.Txt");
  std::cout &lt&lt "\n  Path::toLower(\"Temp.Txt\") = " &lt&lt lower;
  std::cout &lt&lt std::endl;

  title("Demonstrate Directory class");

  <div class="toggleCommentDisplay">// Display contents of current directory</div>

  std::cout &lt&lt "\n  current directory is:\n    " &lt&lt Directory::getCurrentDirectory();
  std::cout &lt&lt "\n  It contains files:";
  std::vector&ltstd::string&gt currfiles = Directory::getFiles();
  <div class="toggleCommentDisplay">///////////////////////////////////////////////////////</div>
  <div class="toggleCommentDisplay">// This works too</div>
  <div class="toggleCommentDisplay">// std::vector&ltstd::string&gt currfiles = d.getFiles();  </div>
  for(size_t i=0; i&ltcurrfiles.size(); ++i)
    std::cout &lt&lt "\n    " &lt&lt currfiles[i].c_str();
  std::cout &e constructor");</div>
    }
  }
  else
  {
    pOStream = new std::ofstream;
    if(typ == binary)
      pOStream-&gtopen(name_.c_str(), std::ios::out | std::ios::binary);
    else
      pOStream-&gtopen(name_.c_str(), std::ios::out);
    if (!(*pOStream).good())
    {
      good_ = false;
      pOStream = nullptr;
      <div class="toggleCommentDisplay">//throw std::runtime_error("\n  open for output failed in File constructor");</div>
    }
  }
  return good_;
}
</div>
<div class="toggleCommentDisplay">//----&lt reads one line of a text file &gt------------------------------------</div>

std::string File::getLine(bool keepNewLines)
{
<div class="toggleMethodDisplay">
  if(pIStream == nullptr || !pIStream-&gtgood())
    throw std::runtime_error("input stream not open");
  if(typ_ == binary)
    throw std::runtime_error("getting text line from binary file");
  if(dirn_ == out)
    throw std::runtime_error("reading output file");

  std::string store;
  while (true)
  {
    v class="toggleCommentDisplay">// we have to restore the current directory so the</div>
  <div class="toggleCommentDisplay">// remaining tests work</div>

  <div class="toggleCommentDisplay">// it's probably easier just to use Path::fileSpec(path, filename)</div>
  <div class="toggleCommentDisplay">// like this:</div>

  for (size_t i = 0; i&ltcurrfiles.size(); ++i)
    std::cout &lt&lt "\n    " &lt&lt Path::fileSpec("c:\\temp\\", currfiles[i]).c_str();

  std::cout &lt&lt "\n";
  std::cout &lt&lt "\n  directories residing in C:/temp are:";
  currdirs = Directory::getDirectories("c:/temp/");
  for(size_t i=0; i&ltcurrdirs.size(); ++i)
    std::cout &lt&lt "\n    " &lt&lt currdirs[i].c_str();
  std::cout &lt&lt "\n";

  <div class="toggleCommentDisplay">// Create directory</div>

  title("Demonstrate FileInfo Class Operations", '=');
  std::cout &lt&lt "\n";

  Directory::setCurrentDirectory(".");
  std::cout &lt&lt "\n  current path is \"" &lt&lt Directory::getCurrentDirectory();
  
  std::string fn1;
  if(argc &gt 1)
    fn1 = argv[1];
  else
    fn1 = "c:\\temp\\test.txt";
  FileInfo fi(fn1);

  if(fi.good())
  {
    std::cout &lt&lt "\n  name: " &lt&lt "\t" &lt&lt fi.name();
    std::cout &lt&lt "\n  date: " &lt&lt "\t" &lt&lt fi.date();
    std::cout &lt&lt "\n  date: " &lt&lt "\t" &lt&lt fi.date(FileInfo::dateformat);
    std::cout &lt&lt "\n  date: " &lt&lt "\t" &lt&lt fi.date(FileInfo::timeformat);
    std::cout &lt&lt "\n  size: " &lt&lt "\t" &lt&lt fi.size() &lt&lt " bytes";
    if(fi.isArchive())
      std::cout &lt&lt "\n  is archive";
    else
      std::cout &lt&lt "\n  is not archive";
    if(fi.isCompressed())
      std::cout &lt&lt "\n  is compressed";
    else
      std::cout &lt&lt "\n  is not compressed";
    if(fi.isDirectory())
      std::cout &lt&lt "\n  is directory";
    else
      std::cout &lt&lt "\n  is not directory";
    if(fi.isEncrypted())
      std::cout &lt&lt "\n  is encrypted";
    else
      std::cout &lt&lt "\n  is not encrypted";
    if(fi.isHidden())
      std::cout &lt&lt "\n  is hidden";
    else
      std::cout &lt&lt "\n  is not hidden";
    if(fi.isNormal())
      std::cout &lt&lt "\n  is normal";
    else
      std::cout &lt&lt "\n  is not normal";
    if(fi.isOffLine())
      std::cout &lt&lt "\n  is offline";
    else
      std::cout &lt&lt "\n  is not offline";
    if(fi.isReadOnly())
      std::cout &lt&lt "\n  is readonly";
    else
      std::cout &lt&lt "\n  is not readonly";
    if(fi.isSystem())
      std::cout &lt&lt "\n  is system";
    else
      std::cout &lt&lt "\n  is not system";
    if(fi.isTemporary())
      std::cout &lt&lt "\n  is temporary";
    else
      std::cout &lt&lt "\n  is not temporary";
  }
  else
    std::cout &lt&lt "\n  filename " &lt&lt fn1 &lt&lt " is not valid in this context\n";

  std::string fn2;
  if(argc &gt 2)
  {
    fn1 = argv[1];
    fn2 = argv[2];
  }
  else
  {
    fn1 = "FileSystem.h";
    fn2 = "FileSystem.cpp";
  }
  FileInfo fi1(fchar ch = pIStream-&gtget();
    if (!isGood())
      return store;
    if (ch == '\n')
    {
      if (keepNewLines)
        store += ch;
      return store;
    }
    store += ch;
  }
}
</div>
<div class="toggleCommentDisplay">//----&lt read all lines of text file into one string &gt----------------------</div>

std::string File::readAll(bool keepNewLines)
{
<div class="toggleMethodDisplay">
  std::string store;
  while (true)
  {
    if (!isGood())
      return store;
    store += getLine(keepNewLines);
    std::locale loc;
    if (store.size() &gt 0 && !std::isspace(store[store.size() - 1], loc))
      store += ' ';
  }
  return store;
}
</div>
<div class="toggleCommentDisplay">//----&lt writes one line of a text to a file &gt------------------------------</div>

void File::putLine(const std::string& s, bool wantReturn)
{
<div class="toggleMethodDisplay">
  if(pOStream == nullptr || !pOStream-&gtgood())
    throw std::runtime_error("output stream not open");
  if(typ_e() &lt&lt " is not smaller than " &lt&lt fi2.name();
    if(fi1.earlier(fi2))
      std::cout &lt&lt "\n  " &lt&lt fi1.name() &lt&lt " is earlier than " &lt&lt fi2.name();
    else
      std::cout &lt&lt "\n  " &lt&lt fi1.name() &lt&lt " is not earlier than " &lt&lt fi2.name();
    std::cout &lt&lt std::endl;
  }
  else
    std::cout &lt&lt "\n  files " &lt&lt fn1 &lt&lt " and " &lt&lt fn2 &lt&lt " are not valid in this context\n";

  title("Demonstrate File class operations", '=');
  std::cout &lt&lt "\n";

  <div class="toggleCommentDisplay">// copy binary file from one directory to another</div>

  File me("../debug/filesystemdemo.exe");
  me.open(File::in, File::binary);
  std::cout &lt&lt "\n  copying " &lt&lt me.name().c_str() &lt&lt " to c:/temp";
  if(!me.isGood())
  {
    std::cout &lt&lt "\n  can't open executable\n";
    std::cout &lt&lt "\n  looking for:\n  ";
    std::cout &lt&lt Path::getFullFileSpec(me.name()) &lt&lt "\n";
  }
  else
  {
    File you("c:/temp/fileSystemdemo.exe");
    you.open(File::out, File::binary);
    if(you.isGood())
    {
      while(me.isGood())
      {
        static size_t count = 0;
        Block b = me.getBlock(1024);
        you.putBlock(b);
        if (++count &lt 10)
        {
          std::cout &lt&lt "\n    reading block of " &lt&lt b.size() &lt&lt " bytes";
          std::cout &lt&lt "\n    writing block of " &lt&lt b.size() &lt&lt " bytes";
        }
        if (b.size() &lt 1024)
        {
          std::cout &lt&lt "\n\n    omitted " &lt&lt count-10 &lt&lt " blocks from display\n\n";
          std::cout &lt&lt "\n    reading block of " &lt&lt b.size() &lt&lt " bytes";
          std::cout &lt&lt "\n    writing block of " &lt&lt b.size() &lt&lt " bytes";
        }
      }
      std::cout &lt&lt "\n";
    }
  }

  <div class="toggleCommentDisplay">// save some filespecs of text files in a vector for File demonstrations</div>

  std::vector&ltstd::string&gt files;
  if(argc == 1)
  {
    std::cout &lt&lt "\n\n  Enter, on the command line, an additional filename to process.\n";
  }

  for(int i=1; i&ltargc; ++i)
  {
    files.push_back(argv[i]);
  }
  files.push_back("FileSystem.cpp");                     <div class="toggleCommentDisplay">// file not on current path</div>
  files.push_back("../FileSystemDemo/FileSystem.cpp");   <div class="toggleCommentDisplay">// file from project directory</div>
  files.push_back("../FileSystemTest.txt");              <div class="toggleCommentDisplay">// file in solution directory</div>
  files.push_back("foobar");                             <div class="toggleCommentDisplay">// doesn't exist</div>

  <div class="toggleCommentDisplay">// open each file and display a few lines of text</div>

  for(size_t i=0; i&ltfiles.size(); ++i)
  {
    File file(files[i]);
    file.open(File::in);
    if(!file.isGood())
    {
      std::cout &lt&lt "\n  Can't open file " &lt&lt file.name();
      std::cout &lt&lt "\n  Here's what the program can't find:\n  " &lt&lt Path: == binary)
    throw std::runtime_error("writing text line to binary file");
  if(dirn_ == in)
    throw std::runtime_error("writing input file");
  for(size_t i=0; i&lts.size(); ++i)
    pOStream-&gtput(s[i]);
  if(wantReturn)
    pOStream-&gtput('\n');
  pOStream-&gtflush();
}
</div>
<div class="toggleCommentDisplay">//----&lt reads a block of bytes from binary file &gt--------------------------</div>

Block File::getBlock(size_t size)
{
<div class="toggleMethodDisplay">
  if(pIStream == nullptr || !pIStream-&gtgood())
    throw std::runtime_error("input stream not open");
  if(typ_ != binary)
    throw std::runtime_error("reading binary from text file");
  if(dirn_ == out)
    throw std::runtime_error("reading output file");
  Block blk;
  if(pIStream)
  {
    for(size_t i=0; i&ltsize; ++i)
    {
      Byte b;
      pIStream-&gtget(b);
      if(pIStream-&gtgood())
        blk.push_back(b);
      else
        break;
    }
  }
  return blk;
}
</div>
<div class="toggleCo

  <div class="toggleCommentDisplay">// test reading non-text files</div>

  title("test reading non-text files", '-');
  std::cout &lt&lt "\n  Attempting to open Visual Studio files.";
  std::cout &lt&lt "\n  These are locked by VS when running from IDE.";
  std::cout &lt&lt "\n  They will open if you run FileSystemDemo from the debug folder,";
  std::cout &lt&lt "\n  provided you've closed the solution in VS.\n";
  std::cout &lt&lt "\n";
  std::string testPath = "./debug";  <div class="toggleCommentDisplay">// run from project directory (what Visual Studio does)</div>
  if (!Directory::exists(testPath))
    testPath = ".";                  <div class="toggleCommentDisplay">// run from solution debug directory</div>
  std::vector&ltstd::string&gt testFiles = Directory::getFiles(testPath);
  for (auto file : testFiles)
  {
    try
    {
      std::string ext = Path::getExt(file);
      if (ext == "exe" || ext == "obj" || ext == "dll" || file == "run.dat")
      {
        <div class="toggleCommentDisplay">/* reading binary file works, but generates a lot of garbage */
        <div class="toggleCommentDisplay">/* I use run.dat to capture this output so including will make output confusing */

        std::cout &lt&lt "  skipping binary file " &lt&lt file &lt&lt "\n";
        continue;
      }
      File test(file);
      test.open(File::in);  <div class="toggleCommentDisplay">// open as text file</div>
      std::cout &lt&lt "\n  processing \"" &lt&lt file &lt&lt "\"\n";
      if (test.isGood())
      {
        std::string text = test.readAll(true);
        std::cout &lt&lt text &lt&lt "\n";
      }
      else
      {
        std::cout &lt&lt "\n  open failed\n";
      }
    }
    catch (std::exception& ex)
    {
      std::cout &lt&lt "\n  Exception: " &lt&lt ex.what() &lt&lt "\n";
    }
  }

  <div class="toggleCommentDisplay">// read text file and write to another text file</div>

  title("writing to c:/temp/test.txt", '-');
  File in("../FileSystemDemo/FileSystem
    <button name="button3" onclick="showHideClass('toggleCommentDisplay')">Show or Hide Conment Contents</button><h3>FileSystem.cpp</h3><pre><div class="toggleCommentDisplay">/////////////////////////////////////////////////////////////////////////////</div>
<div class="toggleCommentDisplay">// FileSystem.cpp - Support file and directory operations                  //</div>
<div class="toggleCommentDisplay">// ver 2.8                                                                 //</div>
<div class="toggleCommentDisplay">// ----------------------------------------------------------------------- //</div>
<div class="toggleCommentDisplay">// copyright © Jim Fawcett, 2012                                           //</div>
<div class="toggleCommentDisplay">// All rights granted provided that this notice is retained                //</div>
<div class="toggleCommentDisplay">// ----------------------------------------------------------------------- //</div>
<div class="toggleCommentDisplay">// Language:  or reading";
  }
  File bufferOut(fileOut);
  bufferOut.open(File::out, File::binary);
  if (!bufferOut.isGood())
  {
    std::cout &lt&lt "\n  could not open \"" &lt&lt fileOut &lt&lt "\" for writing\n\n";
      return 1;
  }
  else
  {
    std::cout &lt&lt "\n  opening: \"" &lt&lt fileOut &lt&lt "\" for writing";
  }
  std::cout &lt&lt "\n";
  const size_t bufLen = 124;
  File::byte buffer[bufLen];
  while (true)
  {
    size_t resultSize = bufferIn.getBuffer(bufLen, buffer);
    <div class="toggleCommentDisplay">//std::cout &lt&lt "\n  reading buffer of size " &lt&lt resultSize &lt&lt " bytes";</div>
    std::string temp1(buffer, resultSize);
    std::cout &lt&lt temp1;
    <div class="toggleCommentDisplay">//std::cout &lt&lt "\n  writing buffer of size " &lt&lt resultSize &lt&lt "bytes";</div>
    bufferOut.putBuffer(resultSize, buffer);
    if (resultSize &lt bufLen || !bufferIn.isGood() || !bufferOut.isGood())
    {
      bufferIn.close();
      bufferOut.close();
      break;
    }
  }
  std::cout &lt&lt "\n\n";
}
</div>
#endif
</pre>  </body>
</html>